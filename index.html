<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rocket Flash QRIS Generator</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 24px; max-width: 900px; margin: auto; }
    input, button, select { font-size: 14px; padding: 8px; }
    .row { display:flex; gap:8px; align-items:center; margin-top:12px; }
    .result { margin-top:18px; background:#f7f7f7; padding:12px; border-radius:6px; }
    img.qr { max-width:320px; border:1px solid #ddd; padding:6px; background:white; display:block; margin-bottom:10px; }
    pre { white-space:pre-wrap; word-break:break-all; background:#111; color:#bfe; padding:12px; border-radius:6px; font-size:12px; }
  </style>
</head>
<body>
  <h1>Generate QRIS</h1>
  <p>Masukkan nominal 5 digit (10000 - 99999), lalu generate QRIS valid dengan CRC otomatis.</p>

  <div class="row">
    <label for="amount">Amount:</label>
    <input type="number" id="amount" min="10000" max="99999" maxlength="5" required placeholder="contoh: 23000"/>
  </div>

  <div class="row">
    <label for="size">Size:</label>
    <select id="size">
      <option value="200x200">200x200</option>
      <option value="300x300" selected>300x300</option>
      <option value="400x400">400x400</option>
    </select>
    <button id="generateBtn">Generate</button>
    <button id="clearBtn">Clear</button>
  </div>

  <div class="result" id="result" style="display:none;">
    <div id="imageWrap">
      <img id="qrImg" class="qr" alt="QR image" />
    </div>

    <h4>QRIS Payload</h4>
    <pre id="payloadBox"></pre>
  </div>

  <script>
    const generateBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultWrap = document.getElementById('result');
    const qrImg = document.getElementById('qrImg');
    const payloadBox = document.getElementById('payloadBox');
    const amountEl = document.getElementById('amount');
    const sizeEl = document.getElementById('size');

    // Template dasar (tanpa CRC & amount)
    const baseTemplate = "00020101021226680016ID.CO.BATPAY.WWW011893600841000000001102150000000000000110303UMI51370014ID.CO.QRIS.WWW0215ID10243568644385204539953033605405{amount}5502015802ID5912Rocket Flash6005BOGOR61051615362070703A01";

    // Hitung CRC16
    function crc16(payload) {
      let crc = 0xFFFF;
      for (let i = 0; i < payload.length; i++) {
        crc ^= payload.charCodeAt(i) << 8;
        for (let j = 0; j < 8; j++) {
          if ((crc & 0x8000) !== 0) {
            crc = (crc << 1) ^ 0x1021;
          } else {
            crc <<= 1;
          }
          crc &= 0xFFFF;
        }
      }
      return crc.toString(16).toUpperCase().padStart(4, '0');
    }

    generateBtn.addEventListener('click', async () => {
      const amount = amountEl.value.trim();
      if (!/^\d{5}$/.test(amount) || +amount < 10000 || +amount > 99999) {
        return alert('Amount harus 5 digit (10000 - 99999).');
      }

      // Susun QRIS
      let payload = baseTemplate.replace("{amount}", amount);
      payload += "6304"; // CRC tag
      const crc = crc16(payload);
      payload += crc;

      // Tampilkan payload & QR
      payloadBox.textContent = payload;
      const size = sizeEl.value;
      const endpoint = `https://api.qrserver.com/v1/create-qr-code/?size=${encodeURIComponent(size)}&data=${encodeURIComponent(payload)}&format=png`;
      qrImg.src = endpoint;
      resultWrap.style.display = 'block';
    });

    clearBtn.addEventListener('click', () => {
      resultWrap.style.display = 'none';
      qrImg.src = '';
      payloadBox.textContent = '';
    });
  </script>
</body>
</html>
